<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>ECALELF: Package Calibration/EcalAlCaRecoProducers</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">


<h1><a class="anchor" id="EcalAlcarecoProducers">Package Calibration/EcalAlCaRecoProducers </a></h1><h2><a class="anchor" id="desc">
Description</a></h2>
<p>This module contains all the plugins and classes used to produce ECAL alcarecos.</p>
<h2><a class="anchor" id="streamList">
AlCaRecoStream list</a></h2>
<ul>
<li>EcalCalElectron</li>
<li>EcalUncalElectron</li>
<li>EcalESAlign</li>
</ul>
<h3><a class="anchor" id="AlCaESAlign">
AlCaESAlign</a></h3>
<p>The aim of this alcareco is to have a reduced dataset with all the information used for ES Alignment.</p>
<p>The event content is defined in ALCARECOEcalESAlign_Output_cff.py</p>
<p>The generalTrack collection (and trackExtras) are reduced by the EcalESAlignTrackReducer plugin in order to save tracks in the ES acceptance</p>
<p>In order to test this alcareco: </p>
<div class="fragment"><pre class="fragment">      cmsDriver.py testES -s ALCA:EcalESAlign --conditions=MCRUN2_74_V1 --filein=root:<span class="comment">//eoscms//eos/cms/store/relval/CMSSW_7_4_0_pre6/RelValZEE_13/GEN-SIM-RECO/PU25ns_MCRUN2_74_V1-v3/00000/04445CDB-7AAB-E411-8E6E-0025905A605E.root -n 100</span>
</pre></div><h3><a class="anchor" id="AlCaESAlign">
AlCaESAlign</a></h3>
<p>(THE PACKAGE ADMINISTATOR SHOULD REPLACE THIS SENTENCE WITH HAND-WRITTEN DOCUMENTATION SAYING WHAT THE PACKAGE DOES.)</p>
<h2><a class="anchor" id="testInstructions">
EcalCalElectron and EcalUncalElectron test instructions</a></h2>
<h3><a class="anchor" id="rawToRecoInstructions">
RAW to RECO production</a></h3>
<div class="fragment"><pre class="fragment">
mkdir {Single,Double}Electron-Run2012D/
SingleElectronRAWFile=/store/data/Run2012D/SingleElectron/RAW/v1/000/208/307/0085A34B-BD3A-E211-B6E9-003048D2BC4C.root
DoubleElectronRAWFile=/store/data/Run2012D/DoubleElectron/RAW/v1/000/208/686/4A4E42F9-3F3F-E211-A942-003048F118AA.root
cmsDriver.py reco -s RAW2DIGI,RECO -n 100 --filein=${SingleElectronRAWFile} --data --conditions=auto:run2_data --nThreads=4 --dirout=SingleElectron-Run2012D/
cmsDriver.py reco -s RAW2DIGI,RECO -n 100 --filein=${DoubleElectronRAWFile} --data --conditions=auto:run2_data --nThreads=4 --dirout=DoubleElectron-Run2012D/
</pre></div><h3><a class="anchor" id="EcalUncalWElectron">
EcalUncalWElectron production from RAW and RECO files</a></h3>
<div class="fragment"><pre class="fragment">
SingleElectronRECOFile=files://$PWD/SingleElectron-Run2012D/reco_RAW2DIGI_RECO.root 
cmsDriver.py reco -s ALCA:EcalUncalWElectron -n 100 --data --conditions=auto:run2_data --nThreads=4 --filein=${SingleElectronRECOFile} --secondfilein=${SingleElectronRAWFile} --dirout=SingleElectron-Run2012D/ --customise_commands="process.options = cms.untracked.PSet(wantSummary = cms.untracked.bool(True))"   
</pre></div><h3><a class="anchor" id="EcalUncalZElectron">
EcalUncalZElectron production from RAW and RECO files</a></h3>
<div class="fragment"><pre class="fragment">
DoubleElectronRECOFile=files://$PWD/DoubleElectron-Run2012D/reco_RAW2DIGI_RECO.root 
cmsDriver.py reco -s ALCA:EcalUncalZElectron -n 100 --data --conditions=auto:run2_data --nThreads=4 --filein=${DoubleElectronRECOFile} --secondfilein=${DoubleElectronRAWFile} --dirout=DoubleElectron-Run2012D/ --customise_commands="process.options = cms.untracked.PSet(wantSummary = cms.untracked.bool(True))"   
</pre></div><h3><a class="anchor" id="EcalCalWElectron">
EcalCalWElectron production from RAW and RECO files</a></h3>
<div class="fragment"><pre class="fragment">
SingleElectronRECOFile=files://$PWD/SingleElectron-Run2012D/reco_RAW2DIGI_RECO.root 
cmsDriver.py reco -s ALCA:EcalCalWElectron -n 100 --data --conditions=auto:run2_data --nThreads=4 --filein=${SingleElectronRECOFile} --secondfilein=${SingleElectronRAWFile} --dirout=SingleElectron-Run2012D/ --customise_commands="process.options = cms.untracked.PSet(wantSummary = cms.untracked.bool(True))"   
</pre></div><h3><a class="anchor" id="EcalCalZElectron">
EcalCalZElectron production from RAW and RECO files</a></h3>
<div class="fragment"><pre class="fragment">
DoubleElectronRECOFile=files://$PWD/DoubleElectron-Run2012D/reco_RAW2DIGI_RECO.root 
cmsDriver.py reco -s ALCA:EcalCalZElectron -n 100 --data --conditions=auto:run2_data --nThreads=4 --filein=${DoubleElectronRECOFile} --secondfilein=${DoubleElectronRAWFile} --dirout=DoubleElectron-Run2012D/ --customise_commands="process.options = cms.untracked.PSet(wantSummary = cms.untracked.bool(True))"   
</pre></div><h3><a class="anchor" id="rereco">
ECALELF rereco: EcalRecalElectron production from EcalUncalElectron files</a></h3>
<p>To make this work, go to cmssw/Configuration/StandardSequences/python/AlCaRecoStreams_cff.py, and uncomment lines matching *Recal* Also replace ecalLocalSequence by * <a href="https://github.com/shervin86/cmssw/blob/toBeChecked/Calibration/EcalAlCaRecoProducers/python/ALCARECOEcalRecalIsolElectron_cff.py#L7">https://github.com/shervin86/cmssw/blob/toBeChecked/Calibration/EcalAlCaRecoProducers/python/ALCARECOEcalRecalIsolElectron_cff.py#L7</a></p>
<div class="fragment"><pre class="fragment">
EcalUncalWElectronFile=files://$PWD/SingleElectron-Run2012D/EcalUncalWElectron.root
cmsDriver.py reco -s ALCA:EcalRecalElectron -n 100 --data --conditions=auto:run2_data --nThreads=4 --filein=${EcalUncalWElectronFile} --dirout=SingleElectron-Run2012D/ --customise_commands="process.options = cms.untracked.PSet(wantSummary = cms.untracked.bool(True))"   --process=RERECO --customise Calibration/EcalAlCaRecoProducers/customRereco.EcalRecal

EcalUncalZElectronFile=files://$PWD/DoubleElectron-Run2012D/EcalUncalZElectron.root
cmsDriver.py reco -s ALCA:EcalRecalElectron -n 100 --data --conditions=auto:run2_data --nThreads=4 --filein=${EcalUncalZElectronFile} --dirout=DoubleElectron-Run2012D/ --customise_commands="process.options = cms.untracked.PSet(wantSummary = cms.untracked.bool(True))"   --process=RERECO --customise Calibration/EcalAlCaRecoProducers/customRereco.EcalRecal
</pre></div> <h3><a class="anchor" id="ntuple">
ntuple production and calibration</a></h3>
<p>Zntuples: </p>
<div class="fragment"><pre class="fragment">
cmsRun EcalAlCaRecoProducers/python/alcaSkimming.py isCrab=0 skim=ZSkim maxEvents=100 type=ALCARECO files=${DoubleElectronRECOFile} doTree=3 tagFile=EcalAlCaRecoProducers/config/reRecoTags/test75x.py
</pre></div><p> Wntuples: </p>
<div class="fragment"><pre class="fragment">
cmsRun EcalAlCaRecoProducers/python/alcaSkimming.py isCrab=0 skim=WSkim maxEvents=100 type=ALCARECO files=${SingleElectronRECOFile} doTree=3 tagFile=EcalAlCaRecoProducers/config/reRecoTags/test75x.py
</pre></div><p>To produce ntuples from EcalCal (AlCaReco), you need to add the option --doTreeOnly=1 for example: </p>
<div class="fragment"><pre class="fragment">
EcalCalZElectronFile=files://$PWD/DoubleElectron-Run2012D/EcalCalZElectron.root
cmsRun EcalAlCaRecoProducers/python/alcaSkimming.py isCrab=0 skim=ZSkim maxEvents=100 type=ALCARECO files=${EcalCalZElectronFile} doTree=3 tagFile=EcalAlCaRecoProducers/config/reRecoTags/test75x.py doTreeOnly=1
</pre></div><p>To produce ntuples from EcalRecal (AlCaRereco), you need to add the option --doTreeOnly=1 and also change the type to ALCARERECO </p>
<div class="fragment"><pre class="fragment">
EcalRecalElectronFile=files://$PWD/DoubleElectron-Run2012D/EcalRecalElectron.root
cmsRun EcalAlCaRecoProducers/python/alcaSkimming.py isCrab=0 skim=ZSkim maxEvents=100 type=ALCARERECO files=${EcalCalZElectronFile} doTree=3 tagFile=EcalAlCaRecoProducers/config/reRecoTags/test75x.py doTreeOnly=1
</pre></div><p>Calibration with E / p: </p>
<div class="fragment"><pre class="fragment">
ZFitter.exe -f data/validation/EoverPcalibration.dat --EOverPCalib --outputPath output/ --doEB --splitStat 0 --nLoops 15
ZFitter.exe -f data/validation/EoverPcalibration.dat --EOverPCalib --outputPath output/ --doEE --splitStat 0 --nLoops 15
</pre></div><h3><a class="anchor" id="grid">
Running on the grid</a></h3>
<p>This is initial documentation on how to automatically generate and submit ALCARECO and ALCARAW jobs on the grid using CRAB3. A special bash script has been adapted to do this: scripts/prodAlcareco.sh</p>
<p>Before you begin, you must do: </p>
<div class="fragment"><pre class="fragment">
source initCmsEnv.sh
</pre></div><p>This will set up the CRAB3 environment and generate a grid proxy. Then, you can actually use the script. Usage is as follows:</p>
<div class="fragment"><pre class="fragment">
./scripts/prodAlcareco.sh `parseDatasetFile.sh alcareco_datasets.dat | grep "query"` --option1 --option2 ...
</pre></div><p>`alcareco_datasets.dat` contains information about the datasets which are available to run on. Select the required dataset using grep. `parseDarasetFile.sh` extracts the required information from the `alcareco_datasets.dat` entry.</p>
<p>An example, for a subsection of runA DoubleElectron, to be processed with ALCA:EcalCalZElectron, ie ALCARECO: The `alcareco_datasets.dat` file has a line like this:</p>
<div class="fragment"><pre class="fragment">
190645-193621 /DoubleElectron/Run2012A-15Apr2014-v2/AOD DoubleElectron-ZHLTSkimPath-RUN2012A-15Apr-v2 caf group/alca_ecalcalib/ecalelf/alcareco VALID RUN2012A,RUN2012AB,RUN2012ABC,RUN2012ABCD
</pre></div><p>Select it in the command using `parseDatasetFile.sh alcareco_datasets.dat | grep A` Create jobs using:</p>
<div class="fragment"><pre class="fragment">
./scripts/prodAlcareco.sh `parseDatasetFile.sh alcareco_datasets.dat | grep A` --json testJSON.txt --jobname Test --skim ZSkim -type ALCARECO --createOnly
</pre></div><p>testJSON.txt contains only one run number from runA: {"190645": [[1, 200]]}</p>
<p>And inspect the CMSSWConfig reco_ALCA.py and CRAB3 config tmp/alcareco_cfg.py to make sure everything seems sensible. You can run a local test by specifiying a test sample in the reco_ALCA.py file and doing cmsRun reco_ALCA.py, which by default runs over 10 events.</p>
<p>Submit the jobs using: </p>
<div class="fragment"><pre class="fragment">
./scripts/prodAlcareco.sh `parseDatasetFile.sh alcareco_datasets.dat | grep A` --json testJSON.txt --jobname Test --skim ZSkim -type ALCARECO --submitOnly
</pre></div><p>CRAB3 should give information about submission success etc.</p>
<p>Subsequently, you can check the jobs using: </p>
<div class="fragment"><pre class="fragment">
./scripts/prodAlcareco.sh `parseDatasetFile.sh alcareco_datasets.dat | grep A` --json testJSON.txt --jobname Test --skim ZSkim -type ALCARECO --check
</pre></div><p>This will query the status of the jobs using the CRAB3 interface.</p>
<p>Other examples: Produce EcalCalZElectron.root (ALCARECO) from AODSIM (Monte Carlo) files. Make sure you have a line like this in alcareco_datasets.dat: </p>
<div class="fragment"><pre class="fragment">
allRange /DYToEE_M-50_Tune4C_13TeV-pythia8/Phys14DR-PU40bx25_tsg_castor_PHYS14_25_V1-v2/AODSIM DYToEE_M-50-pythia8-Phys14-ZSkim-19May2015 caf group/alca_ecalcalib/ecalelf/alcareco VALID - -
</pre></div><p> Then run: </p>
<div class="fragment"><pre class="fragment">
./scripts/prodAlcareco.sh `parseDatasetFile.sh alcareco_datasets.dat | grep 19May` --skim ZSkim --type ALCARECO --isMC --jobname name
</pre></div><p>Produce EcalUncalZElectron.root (ALCARAW) from Double Electron AOD (with appropriate line in alcareco_datasets.dat). </p>
<div class="fragment"><pre class="fragment">
./scripts/prodAlcareco.sh `parseDatasetFile.sh alcareco_datasets.dat | grep xxx` --skim ZSkim --type ALCARAW  --jobname name
</pre></div><p>Produce EcalUncalWElectron.root (ALCARAW) from Single Electron AOD (with appropriate line in alcareco_datasets.dat). </p>
<div class="fragment"><pre class="fragment">
./scripts/prodAlcareco.sh `parseDatasetFile.sh alcareco_datasets.dat | grep xxx` --skim WSkim --type ALCARAW  --jobname name
</pre></div><p>Produce EcalCalZElectron.root (ALCARECO) from Single Electron RAW (with appropriate line in alcareco_datasets.dat). </p>
<div class="fragment"><pre class="fragment">
./scripts/prodAlcareco.sh `parseDatasetFile.sh alcareco_datasets.dat | grep xxx` --skim ZSkim --type ALCARECO --fromRAW --jobname name
</pre></div><p>Produce EcalUncalZElectron.root (ALCARAW) from Single Electron RAW (with appropriate line in alcareco_datasets.dat). </p>
<div class="fragment"><pre class="fragment">
./scripts/prodAlcareco.sh `parseDatasetFile.sh alcareco_datasets.dat | grep xxx` --skim ZSkim --type ALCARAW --fromRAW --jobname name
</pre></div><h3><a class="anchor" id="interface">
Public interface</a></h3>
<ul>
<li>AlCaElectronsProducer</li>
</ul>
<h3><a class="anchor" id="pluginai">
Plugins</a></h3>
<h3><a class="anchor" id="modules">
Modules</a></h3>
<ul>
<li>AlCaElectronsProducer</li>
<li>AlCaElectronsTest</li>
</ul>
<h3><a class="anchor" id="tests">
Unit tests and examples</a></h3>
<p>Unknown</p>
<h2><a class="anchor" id="status">
Status and planned development</a></h2>
<p>Unknown</p>
<hr/>
 Last updated: @ Author: computer-generated. </p>
</div>
<hr size="1"/><address style="text-align: right;"><small>Generated on 26 Jan 2017 for ECALELF by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
