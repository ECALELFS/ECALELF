<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>ECALELF: How to work with ECALELF ntuples</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.4.7 -->
<div class="tabs">
  <ul>
    <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
    <li><a href="namespaces.html"><span>Namespaces</span></a></li>
    <li><a href="annotated.html"><span>Classes</span></a></li>
    <li><a href="dirs.html"><span>Directories</span></a></li>
    <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
  </ul></div>
<h1><a class="anchor" name="page4">How to work with ECALELF ntuples</a></h1><div class="fragment"><pre class="fragment">############## Introduction to ECALELF Z Fitter 
# ECALELF Z Fitter is designed to be a flexible tool to fit the Z
# lineshape using the ECALELF ZNtuples.

Go to the Calibration/ZFitter directory and compile it:
make

Calibration/ZFitter will be your working directory now on.


There are three important directories where the proper .dat files should be put:
 - data/validation/
   For the validation of rerecoes, the .dat files has to be put in a subdirectory of data/validation:
   ./data/validation/rereco/rerecoGroupName/
   where rerecoGroupName is a name that you assign to a group of rerecoes that you want to test
   for example: you can use ./data/validation/rereco/Cal_Dic2013/
                or ./data/validation/rereco/ungrouped/
   this way the fit results will be put under the subdirectory
   rerecoGroupName and you will be able to move or remove it when the
   set of validations has finished. 

   The logic of the validation .dat files is reported below in a
   dedicated section.


- data/regions/
  the fits are done in categories, the conditions that the electrons
  have to fulfil are defined in .dat files in this directory.
  In each .dat file, a set of categories are defined, one category for
  each line: for example
  EB
  EE
  EB-gold
  EB-absEta_0_1-bad
  the sintax used to define the categories is reported at the
  beginning of 
  interface/ElectronCategory_class.hh

  For standard validations you can use the data/regions/validation.dat
  that is set in the scripts as the default one.

- data/runRanges/
  contains files that define a set of run ranges in order to perform
  the fits for the stability plots. The default one to be used is
  data/runRanges/monitoring.dat

  The syntax is the following:
  #runMin-runMax nEvents        timeStampMin-timeStampMax
  190645-190781	28734   	1333819264-1333983242
  190782-191042	24007		1334023525-1334188134
  The second and third column are optional.
  
#============================== validation config .dat file creation to be put in data/validation/
This config file contains the list of files to run on, the files
containing the PU histograms for the PU reweighting and all the other
files needed.
The main idea in the ECALELF framework is to have a minimum set of
variables in very small trees (the tree name is "selected"), while
additional branches can be produced and added if needed as tree
friends. The advantage is the possibility to produce ntuples for a
larger set of studies with small specific trees for each of them. 


The file is structured in 3 columns: tag, treeName and filePath as in the follows:
# commented lines
# tag	treeName	file
s1	selected	root://eoscms//eos/..../file.root
s2	selected	root://eoscms//eos/..../file.root
d1	selected	root://eoscms//eos/..../file.root
d	pileupHist	/afs/cern.ch/cms/CAF/CMSALCA/ALCA_ECALCALIB/ECALELF/puFiles/190456-204567-13Julv2_lastPrompt.69400.observed.root
s	pileupHist	/afs/cern.ch/cms/CAF/CMSALCA/ALCA_ECALCALIB/ECALELF/puFiles/nPU-Summer12_DD3.observed.root

	The first column (tag) indicates if this file is signal MC (s), background MC (b), or data (d). 
        The single samples are indicated by a number (s1, s2, etc., d1, d2, etc.)
	The second column (treeName) is the name of the tree in the file
	The third column (filePath) is the full path of the file
	files with the same tag and the same treeName are put in the
        same chain
	files with the same tag but different treeName are added as
	friends 


#======================================== Working with ntuples: how to
#                                         play by hand with ntuples

If you are interested only in using the fit for validations you can
skip this paragraphs and go directly to "RERECO VALIDATION instructions"

The .dat config file keeping the list of ntuples can be modified according to the needs adding or commenting unuseful ntuples or friend trees.
It's then important to have a simple way to merge the trees in order to be able to manipulate, scan and plot variables from the ntuples.
The ZFitter/script/GenRootChain.sh has been designed for this.

running the command:
./script/GenRootChain.sh -f data/validation/myConfigFile.dat 
in the tmp/ the s_chain.root, d_chain.root load.C are created for MC and data respectively.
The .root files have the TChains already defined, merging the files with the same treeName in the config file and adding the friends properly. 
Due to a bug in ROOT in order to properly load the files the load.C script is created.

To work with ntuples you can do (see pratical example below):
root -l tmp/d_chain.root tmp/s_chain.root tmp/load.C
data    -&gt; Draw("*");
signalA -&gt; Draw("*");

NB: Please check in the load.C file the correct assignment of the tree pointer to the correct file.

#============================== Data/MC plots
A standard function for data/MC plots have been prepared and is available in macro/PlotDataMC.C

In the following you can find an example of production of data/MC plots with a config file with 
22Jan rereco data, run dependent MC (three samples with different generators: s1, s2, s3)
./script/GenRootChain.sh -f data/validation/22Jan2012-runDepMCAll_v2.dat
root -l -b -q tmp/d_chain.root tmp/s1_chain.root tmp/s2_chain.root tmp/load.C macro/standardDataMC.C

*****************
The load.C script is commented below:
{
  gROOT-&gt;ProcessLine(".L macro/PlotDataMC.C+"); // -&gt; functions for data/MC plots
  gROOT-&gt;ProcessLine(".L src/setTDRStyle.C");
  gROOT-&gt;ProcessLine(".L macro/addChainWithFriends.C+"); // -&gt; functions to work around ROOT bugs in friend treatment

  setTDRStyle1();

  TChain *data   = (TChain *) _file0-&gt;Get("selected");  // -&gt; pointers to samples
  TChain *signalA = (TChain *) _file1-&gt;Get("selected"); // -&gt; pointers to samples
  TChain *signalB = (TChain *) _file2-&gt;Get("selected"); // -&gt; pointers to samples
  TChain *signalC = (TChain *) _file3-&gt;Get("selected"); // -&gt; pointers to samples

  ReassociateFriends(_file0, data);    // -&gt; functions to correct associate the friends to their main trees
  ReassociateFriends(_file1, signalA); // -&gt; functions to correct associate the friends to their main trees
  ReassociateFriends(_file2, signalB); // -&gt; functions to correct associate the friends to their main trees
  ReassociateFriends(_file3, signalC); // -&gt; functions to correct associate the friends to their main trees

   TDirectory *curDir = new TDirectory("curDir","");
   curDir-&gt;cd();

  TString outputPath="tmp/";

// look at standardDataMC.C for some examples  
}
*****************
The standardDataMC.C example:
{
  std::vector&lt;TString&gt; mcLabel_vec;  // create a vector of labels for the MC samples
  mcLabel_vec.push_back("Madgraph");
  mcLabel_vec.push_back("Powheg");
  mcLabel_vec.push_back("Sherpa");

  //MakeChainVector(signalA,signalB,signalC) 
  
  c = PlotDataMCs(data, // pointer to data chain
                  MakeChainVector(signalA,signalB,signalC), // creates a vector of chains for MCs
                  "etaEle",  // variable to be plotted
                  "(100,-2.5,2.5)", // binning of x axis
                  "eleID_loose-trigger-noPF-Et_25", // stream based selection with ECALELF convention -&gt; a specific class takes care in parsing the string and provide the selections cuts
                  "", // additional selection string in standard ROOT syntax,
                  "Data", // label for data in Legend
                   mcLabel_vec, // vector of strings for MC labels in legend
                   "#eta", // x axis title
                   "", 
                   false, // do plot in log scale
                   true // reweight MC for PU
                   ); // use r9weight
   c-&gt;SaveAs(outputPath+"etaEle-r9reweighted-Et_25.eps");
   c-&gt;SaveAs(outputPath+"etaEle-r9reweighted-Et_25.C");
  delete c;
}




</pre></div> <hr size="1"><address style="align: right;"><small>Generated on 29 Jan 2014 for ECALELF by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.4.7 </small></address>
</body>
</html>
