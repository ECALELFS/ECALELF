<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>ECALELF: Generating PU weight files</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="navpath"><a class="el" href="index.html">index</a>&nbsp;&raquo&nbsp;<a class="el" href="WORKNTUPLES.html">How to work with ECALELF ntuples</a>
  </div>
</div>
<div class="contents">


<h1><a class="anchor" id="PUFILES_">Generating PU weight files </a></h1><p>PU weights can be generated following the <b>official</b> <b>recipe</b> or by the "quick and dirty" reweight using the reconstructed number of primary vertices (nPV)</p>
<p>In both cases what is needed is:</p>
<ul>
<li>a distribution for MC</li>
<li>a distribution for data</li>
<li>name of the variable in ntuples to be used as inputs for the event-by-event weight assignment</li>
</ul>
<p>The files with the PU distributions should be added to the config file used by ZFitter (for more info about the config files see <a class="el" href="ZFitterConfigFiles.html">Config files syntax and generation</a>)</p>
<h2><a class="anchor" id="OFFICIALPUWEIGHTS_">
Official recipe for PU weights</a></h2>
<h3><a class="anchor" id="MCPUtrue_">
MC true PU</a></h3>
<p>The MC distribution is the true PU distribution defined in the PU scenario during the MC generation. There is a python config file in CMSSW that contains the values. The files can be found in </p>
<div class="fragment"><pre class="fragment">SimGeneral/MixingModule/python </pre></div><p> Make sure you pick up the right file matching the PU scenario used in your MC.</p>
<p>The MC pileup histograms should be put on EOS in the calibration project directory: </p>
<div class="fragment"><pre class="fragment">/eos/project/c/cms-ecal-calibration/data/puHistos/  </pre></div><p>To generate this MC Pileup root file: </p>
<div class="fragment"><pre class="fragment">
cd $CMSSW_BASE/Calibration/ZFitter/;
python script/generateMCPUHist.py PileupCFI=mix_2016_25ns_SpringMC_PUScenarioV1_PoissonOOTPU_cfi output=PUSpring16-nPUtrue.root
</pre></div><p># pileup scenarios</p>
<p>scenario | python file | pileupHist root file ---------- | ------------------------------------------------------- | ------------------------- PUSpring16 | mix_2016_25ns_SpringMC_PUScenarioV1_PoissonOOTPU_cfi.py | PUSpring16-nPUtrue.root PUMoriond17 | mix_2016_25ns_Moriond17MC_PoissonOOTPU_cfi.py | PUMoriond17-nPUtrue.root</p>
<h3><a class="anchor" id="DATAPUtrue_">
True PU distribution in data</a></h3>
<p>Instructions can be found in <a href="https://twiki.cern.ch/twiki/bin/viewauth/CMS/PileupJSONFileforData">PileupJSONFileforData </a></p>
<p>In summary you need:</p>
<ul>
<li>json file used in your analysis</li>
<li>location of the pileup json file</li>
<li>minimum bias cross section</li>
</ul>
<p>To generate the root file with the <b>pileup</b> histogram: </p>
<div class="fragment"><pre class="fragment">
JSONFILE=/afs/cern.ch/cms/CAF/CMSCOMM/COMM_DQM/certification/Collisions16/13TeV/ReReco/Final/Cert_271036-284044_13TeV_23Sep2016ReReco_Collisions16_JSON.txt
PileUpJSON=/afs/cern.ch/cms/CAF/CMSCOMM/COMM_DQM/certification/Collisions16/13TeV/PileUp/pileup_latest.txt
OUTPUTFILE=271036-284044_23Sept_v1-nPUtrue.root
pileupCalc.py -i $JSONFILE --inputLumiJSON $PileUpJSON --calcMode true --minBiasXsec 69200 --maxPileupBin 50 --numPileupBins 50 $OUTPUTFILE
</pre></div><h2><a class="anchor" id="NPV_">
Using Number of Primary Vertices</a></h2>
<p>The <b>pileup</b> histograms can simply be histograms of the <b>nPV</b> branch for data and MC. <b>CAVEAT:</b> the nPV is biased by the selection used in your sample, to reduce the data/MC difference, please apply the full selection of your analysis.</p>
<p>The name of the tree in the config file has to contain the string "nPV": </p>
<div class="fragment"><pre class="fragment">
s   pileupHist_nPV   file.root
</pre></div><p>------------------------------ The files containing the histograms for the PU reweight are indicated with pileupHist as treeName and they are treated in a different way. There must be only one pileupHist for d and one for s, then the program calculates the weights for the MC, produces a temporary file with just one tree containing the weights (pileupTree) and it is added as friend to the chain of MC. You can also provide directly the "temporary" root file indicating s pileupTree file.root</p>
<p>------------------------------------------ </p>
</div>
<hr size="1"/><address style="text-align: right;"><small>Generated on 26 Jan 2017 for ECALELF by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
