process Calibration =
{

# initialize  MessageLogger
 include "FWCore/MessageLogger/data/MessageLogger.cfi"

 source = PoolSource
   {
       untracked vstring fileNames = 
       {'/store/mc/2006/12/22/mc-physval-120-WToENU-Calib-LowLumi/0029/0CE4ADE2-B2B2-DB11-980E-001731A28BE1.root'}


       untracked int32 maxEvents = 100

   }

   # CTF track fit with material
   # magnetic field
   include "MagneticField/Engine/data/volumeBasedMagneticField.cfi"

   # cms geometry
   #include "Geometry/TrackerRecoData/data/trackerRecoGeometryXML.cfi"
   include "Geometry/CMSCommonData/data/cmsIdealGeometryXML.cfi"

   # tracker geometry
   include "Geometry/TrackerGeometryBuilder/data/trackerGeometry.cfi"

   # tracker numbering
   include "Geometry/TrackerNumberingBuilder/data/trackerNumberingGeometry.cfi"

   # KFUpdatoerESProducer
   include "TrackingTools/KalmanUpdators/data/KFUpdatorESProducer.cfi"

   # Chi2MeasurementEstimatorESProducer
   include "TrackingTools/KalmanUpdators/data/Chi2MeasurementEstimatorESProducer.cfi"

   # KFTrajectoryFitterESProducer
   include "TrackingTools/TrackFitters/data/KFTrajectoryFitterESProducer.cfi"

   # KFTrajectorySmootherESProducer
   include "TrackingTools/TrackFitters/data/KFTrajectorySmootherESProducer.cfi"

   # KFFittingSmootherESProducer
   include "TrackingTools/TrackFitters/data/KFFittingSmootherESProducer.cfi"

   # PropagatorWithMaterialESProducer
   include "TrackingTools/MaterialEffects/data/MaterialPropagator.cfi"

   # PropagatorWithMaterialESProducer
   include "TrackingTools/MaterialEffects/data/OppositeMaterialPropagator.cfi"
   
   # stripCPE
   include "RecoLocalTracker/SiStripRecHitConverter/data/StripCPEfromTrackAngle.cfi"
   include "RecoLocalTracker/SiStripRecHitConverter/data/SiStripRecHitMatcher.cfi"
   
   # pixelCPE
   include "RecoLocalTracker/SiPixelRecHits/data/PixelCPEParmError.cfi"
   
   #TransientTrackingBuilder
   include "RecoTracker/TransientTrackingRecHit/data/TransientTrackingRecHitBuilderWithoutRefit.cfi"
   include "RecoTracker/TrackProducer/data/CTFFinalFitWithMaterial.cff"
   replace ctfWithMaterialTracks.src = "pixelMatchGsfElectrons"
   replace ctfWithMaterialTracks.TTRHBuilder = "WithoutRefit"


   # complete clustering sequence
include "RecoEcal/EgammaClusterProducers/data/ecalClusteringSequence.cff"
   
   # sequence to make pixel-based Gsf electrons
include "RecoEgamma/EgammaElectronProducers/data/pixelMatchGsfElectronSequence.cff"
   
    sequence EGammaReco = { ecalClusteringSequence, pixelMatchGsfElectronSequence }

   module electronFilter = EtaPtMinElectronSelector
    {
	InputTag src = pixelMatchGsfElectrons
	bool filter = true
	double ptMin = 5.0
	double etaMin = -2.7
	double etaMax = 2.7
    }
  
#  AlCaElectrons producer
module alCaIsolatedElectrons = AlCaElectronsProducer
{
    InputTag ebRecHitsLabel = ecalRecHit:EcalRecHitsEB
    InputTag electronLabel = electronFilter
    
    string alcaBarrelHitCollection = "alcaBarrelHits"
    
    int32 etaSize = 11
    int32 phiSize = 21
}


module calibration = ElectronCalibration {
   string rootfile = "WenuRecalib.root"    
   InputTag ebRecHitsLabel = alCaIsolatedElectrons:alcaBarrelHits
   InputTag electronLabel = electronFilter
   InputTag trackLabel = ctfWithMaterialTracks
   string CALIBRATION_ALGO = "L3"    
   }

module out = PoolOutputModule
 {
        untracked vstring outputCommands =
          {
            "drop *",
            "keep recoElectrons_*_*_*",
            "keep recoSuperClusters_*_*_*",
            "keep  TrackCandidates_pixelGsfMatchElectrons_*_*",
            "keep  *_electronFilter_*_*",
            "keep  *_alCaIsolatedElectrons_*_*"
          }
	  
    untracked string fileName = "alcarecowithtracks.root"
 }

 path p = {EGammaReco,electronFilter,alCaIsolatedElectrons,calibration }

 endpath e = { out}

}
