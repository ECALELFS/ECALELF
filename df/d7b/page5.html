<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.5"/>
<title>ECALELF: Rereco production</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">ECALELF
   &#160;<span id="projectnumber">NAN</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.5 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="../../index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="../../pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="../../annotated.html"><span>Classes</span></a></li>
      <li><a href="../../files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Rereco production </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="RERECO"></a>
RERECO</h1>
<p>The ReReco and the ntuple production can be run with the script EcalAlCaRecoProducers/scripts/RerecoQuick.sh from the directory EcalAlCaRecoProducers</p>
<h2><a class="anchor" id="RERECO_inputFiles"></a>
Input files</h2>
<ol type="1">
<li>EcalAlCaRecoProducers/config/reRecoTags/tag_name.py: is the file where the GT and the list of tags to be used for the rereco and the ntuple production have to be specified. <b>"tag_name"</b> is the name that will be automatically assigned to all the directories created for the rereco and the ntuples (the crab directory in EcalAlCaRecoProducers/prod_alcarereco and the directories in eos with the reco files and the ntuples). <b>More</b> info in <a class="el" href="../../df/d7b/page5.html#TAGFILES">TAG FILES</a></li>
<li>alcaraw_datasets.dat is the file with the list of the available alcaraw files</li>
</ol>
<h2><a class="anchor" id="RERECO_outputFiles"></a>
Output files</h2>
<ol type="1">
<li>alcarereco_datasets.dat is the file with the list of all the rerecos already done</li>
<li>ntuple_datasets.dat is the file with the list of all the ntuples already produced These two files are updated automatically with a line that summarizes all the relevant information about the rereco/ntuples (run range, dataset name, alcaraw name, storage_element, user_remote_dir_base, tag_name and, for ntuples, if they are produced from alcareco or alcarecosim and ...) when the script RerecoQuick.sh is launched</li>
<li>The rereco files produced are stored in /eos/cms/store/group/alca_ecalcalib/ecalelf/alcarereco/8TeV/tag_name</li>
<li>The final merged ntuple is stored in: /eos/cms/store/group/alca_ecalcalib/ecalelf/ntuples/8TeV/ALCARERECO/tag_name/</li>
</ol>
<h2><a class="anchor" id="RERECO_instructions"></a>
Instructions</h2>
<ol type="1">
<li><b>CREATE</b> the tag_name.py in EcalAlCaRecoProducers/config/reRecoTags directory <br/>
 Se more detailes below, in section "TAG FILE"</li>
<li>check the syntax of the tag_name.py file <div class="fragment"></div><!-- fragment --></li>
<li>commit the file in GITHUB: <div class="fragment"><div class="line">git add config/reRecoTags/tag_name.py</div>
<div class="line">git commit -m <span class="stringliteral">&quot;....&quot;</span> config/reRecoTags/tag_name.py</div>
</div><!-- fragment --></li>
<li>Add the period on which the ReReco has to be run in alcaraw_datasets.dat, if not already defined (e.g. RUN2012AB)</li>
<li>Run the script RerecoQuick.sh <div class="fragment"><div class="line">./scripts/RerecoQuick.sh -p period -t config/reRecoTags/tag_name.py --json=jsonFile.txt --json_name={runMin}-{runMax}_{prompt,rereconame}_{jsonVersion} </div>
</div><!-- fragment --> where:<ul>
<li>config/reRecoTags/tag_name.py is the configuration file defined in step1</li>
<li>jsonFile.txt is the version of the json file to be used (pFindJson)</li>
<li>json_name is the name that ECALELF gives to the json file used for the ntuple production.</li>
</ul>
</li>
</ol>
<ul>
<li>if you run this the system with ask you your PEM passphrase, which corresponds to the grid passphrase</li>
<li>if you don't have caf privilege add the option &ndash;scheduler=lsf at the end of the command <b> Not yet tested!!! </b></li>
</ul>
<h2><a class="anchor" id="rerecoExample"></a>
Rereco example:</h2>
<div class="fragment"><div class="line">./scripts/RerecoQuick.sh -p RUN2012ABCD -t config/reRecoTags/Cal_Dic2013_ZeeIC_v1_mo_b.py --json=/afs/cern.ch/cms/CAF/CMSCOMM/COMM_DQM/certification/Collisions12/8TeV/Reprocessing/Cert_190456-208686_8TeV_22Jan2013ReReco_Collisions12_JSON.txt --json_name=190456-208686_22JanReReco_v1  --tutorial</div>
</div><!-- fragment --><p> The files alcarereco_datasets.dat and ntuple_datasets.dat ae updated when this script is launched</p>
<ol type="1">
<li><p class="startli">check the exit status of the jobs: </p>
<div class="fragment"><div class="line">./scripts/RerecoQuick.sh  -p period -t config/reRecoTags/tag_name.py --json=jsonFile.txt --json_name={runMin}-{runMax}_{prompt,rereconame}_{jsonVersion} --check</div>
</div><!-- fragment --><p class="startli">This command will loop over all folders corresponding to the different datasets and check if jobs are exited with status 0 If jobs are finished, it merge all the produced ntuples and copy them to the right directory on EOS</p>
</li>
<li>if all went fine, commit the alcarereco_datasets.dat and ntuple_datasets.dat files <div class="fragment"><div class="line">git pull --no-commit</div>
</div><!-- fragment --> this will try to merge your local repository with the central one. If there are no conflicts you just need to commit the changes, otherwise you should go throu the files in conflict, resolve them by hand and do <div class="fragment"><div class="line">git add file.cc </div>
</div><!-- fragment --> to say that the confict on the file.cpp has been solved and now is staged for commit</li>
</ol>
<p>And then you must: </p>
<div class="fragment"><div class="line">git commit -m <span class="stringliteral">&quot;rereco tag_name done&quot;</span> alcarereco_datasets.dat ntuple_datasets.dat</div>
</div><!-- fragment --><h2><a class="anchor" id="RERECO_scriptOptions"></a>
Script options</h2>
<p>&ndash;singleEle : to rereco also single electron datasets</p>
<h1><a class="anchor" id="TAGFILES"></a>
TAG FILES</h1>
<p>To run the Rereco with a new set of conditions it is necessary to have a configuration file with the tags.</p>
<p>An example of a configuration file can be found in Calibration/EcalAlCaRecoProducers/config/reRecoTags/test75x.py</p>
<p>Here an example: </p>
<div class="fragment"><div class="line"><span class="preprocessor">##############################################################</span></div>
<div class="line"><span class="preprocessor"></span><span class="keyword">import</span> FWCore.ParameterSet.Config as cms</div>
<div class="line">from CondCore.DBCommon.CondDBSetup_cfi <span class="keyword">import</span> *</div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#### Please fill with comments</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor"># Basic tag combination for 2012 end year seminar conditions</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor"># Laser, alpha tags are fixed: no time to improve them</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor"># A set of IC are derived on top of them and will be tested:</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor"># Cal_Nov2012_ICEle_v2:</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor"># description</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#</span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line">RerecoGlobalTag = cms.ESSource(<span class="stringliteral">&quot;PoolDBESSource&quot;</span>,</div>
<div class="line">                               CondDBSetup,</div>
<div class="line">                               connect = cms.string(<span class="stringliteral">&#39;frontier://FrontierProd/CMS_COND_31X_GLOBALTAG&#39;</span>),</div>
<div class="line">                               globaltag = cms.string(<span class="stringliteral">&#39;GR_R_53_V13::All&#39;</span>),</div>
<div class="line">                               toGet = cms.VPSet(</div>
<div class="line">    cms.PSet(record = cms.string(<span class="stringliteral">&quot;EcalLaserAPDPNRatiosRcd&quot;</span>),</div>
<div class="line">             tag = cms.string(<span class="stringliteral">&#39;EcalLaserAPDPNRatios_data_20120814_2011-2012_v3_upd20120919&#39;</span>),</div>
<div class="line">             connect = cms.untracked.string(<span class="stringliteral">&quot;frontier://FrontierProd/CMS_COND_42X_ECAL_LAS&quot;</span>)</div>
<div class="line">             )</div>
<div class="line">    ,cms.PSet(record = cms.string(<span class="stringliteral">&#39;EcalLaserAlphasRcd&#39;</span>),</div>
<div class="line">              tag = cms.string(<span class="stringliteral">&#39;EcalLaserAlphas_EB_sic1_btcp152_EE_sic1_btcp116&#39;</span>),</div>
<div class="line">              connect = cms.untracked.string(<span class="stringliteral">&#39;frontier://FrontierInt/CMS_COND_ECAL&#39;</span>)</div>
<div class="line">              )</div>
<div class="line">    ,cms.PSet(record = cms.string(<span class="stringliteral">&quot;EcalIntercalibConstantsRcd&quot;</span>),</div>
<div class="line">              tag = cms.string(<span class="stringliteral">&#39;EcalIntercalibConstants_V20120922_Ele19092012_2012IncEtaScale8TeV&#39;</span>),</div>
<div class="line">              connect = cms.untracked.string(<span class="stringliteral">&quot;frontier://FrontierInt/CMS_COND_ECAL&quot;</span>)</div>
<div class="line">              )</div>
<div class="line">    ),</div>
<div class="line">                               BlobStreamerName = cms.untracked.string(<span class="stringliteral">&#39;TBufferBlobStreamingService&#39;</span>)</div>
<div class="line">                               )</div>
<div class="line"></div>
<div class="line">#############################################################</div>
</div><!-- fragment --><p>The convention is to name these configuration files in this way: tag_name.py</p>
<p>So, for the rereco production follow the steps below: </p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="../../doxygen.png" alt="doxygen"/>
</a> 1.8.5
</small></address>
</body>
</html>
