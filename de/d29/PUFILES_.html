<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.5"/>
<title>ECALELF: Generating PU weight files</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">ECALELF
   &#160;<span id="projectnumber">NAN</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.5 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="../../index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="../../pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="../../modules.html"><span>Modules</span></a></li>
      <li><a href="../../annotated.html"><span>Classes</span></a></li>
      <li><a href="../../files.html"><span>Files</span></a></li>
    </ul>
  </div>
<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="../../index.html">index</a></li><li class="navelem"><a class="el" href="../../dd/df8/WORKNTUPLES.html">How to work with ECALELF ntuples</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Generating PU weight files </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#OFFICIALPUWEIGHTS_">Official recipe for PU weights</a><ul><li class="level2"><a href="#MCPUtrue_">MC true PU</a></li>
<li class="level2"><a href="#DATAPUtrue_">True PU distribution in data</a></li>
</ul>
</li>
<li class="level1"><a href="#NPV_">Using Number of Primary Vertices</a></li>
</ul>
</div>
<div class="textblock"><p>PU weights can be generated following the <b>official</b> <b>recipe</b> or by the "quick and dirty" reweight using the reconstructed number of primary vertices (nPV)</p>
<p>In both cases what is needed is:</p>
<ul>
<li>a distribution for MC</li>
<li>a distribution for data</li>
<li>name of the variable in ntuples to be used as inputs for the event-by-event weight assignment</li>
</ul>
<p>The files with the PU distributions should be added to the config file used by ZFitter (for more info about the config files see <a class="el" href="../../d8/d25/ZFitterConfigFiles.html">Config files syntax and generation</a>)</p>
<h1><a class="anchor" id="OFFICIALPUWEIGHTS_"></a>
Official recipe for PU weights</h1>
<h2><a class="anchor" id="MCPUtrue_"></a>
MC true PU</h2>
<p>The MC distribution is the true PU distribution defined in the PU scenario during the MC generation. There is a python config file in CMSSW that contains the values. The files can be found in</p>
<pre class="fragment">SimGeneral/MixingModule/python </pre><p> Make sure you pick up the right file matching the PU scenario used in your MC.</p>
<p>The MC pileup histograms should be put on EOS in the calibration project directory: </p>
<pre class="fragment">/eos/project/c/cms-ecal-calibration/data/puHistos/  </pre><p>To generate this MC Pileup root file: </p>
<pre class="fragment">cd $CMSSW_BASE/Calibration/ZFitter/;
python script/generateMCPUHist.py PileupCFI=mix_2016_25ns_SpringMC_PUScenarioV1_PoissonOOTPU_cfi output=PUSpring16-nPUtrue.root
</pre><h1>pileup scenarios</h1>
<table class="doxtable">
<tr>
<th>scenario </th><th>python file </th><th>pileupHist root file  </th></tr>
<tr>
<td>PUSpring16 </td><td>mix_2016_25ns_SpringMC_PUScenarioV1_PoissonOOTPU_cfi.py </td><td>PUSpring16-nPUtrue.root </td></tr>
<tr>
<td>PUMoriond17 </td><td>mix_2016_25ns_SpringMC_PUScenarioV1_PoissonOOTPU_cfi.py </td><td>PUMoriond17-nPUtrue.root </td></tr>
</table>
<h2><a class="anchor" id="DATAPUtrue_"></a>
True PU distribution in data</h2>
<p>Instructions can be found in <a href="https://twiki.cern.ch/twiki/bin/viewauth/CMS/PileupJSONFileforData">PileupJSONFileforData </a></p>
<p>In summary you need:</p>
<ul>
<li>json file used in your analysis</li>
<li>location of the pileup json file</li>
<li>minimum bias cross section</li>
</ul>
<p>To generate the root file with the <b>pileup</b> histogram: </p>
<pre class="fragment">JSONFILE=/afs/cern.ch/cms/CAF/CMSCOMM/COMM_DQM/certification/Collisions16/13TeV/ReReco/Final/Cert_271036-284044_13TeV_23Sep2016ReReco_Collisions16_JSON.txt
PileUpJSON=/afs/cern.ch/cms/CAF/CMSCOMM/COMM_DQM/certification/Collisions16/13TeV/PileUp/pileup_latest.txt
OUTPUTFILE=271036-284044_23Sept_v1-nPUtrue.root
pileupCalc.py -i $JSONFILE --inputLumiJSON $PileUpJSON --calcMode true --minBiasXsec 69200 --maxPileupBin 50 --numPileupBins 50 $OUTPUTFILE
</pre><h1><a class="anchor" id="NPV_"></a>
Using Number of Primary Vertices</h1>
<p>The <b>pileup</b> histograms can simply be histograms of the <b>nPV</b> branch for data and MC. <b>CAVEAT:</b> the nPV is biased by the selection used in your sample, to reduce the data/MC difference, please apply the full selection of your analysis.</p>
<p>The name of the tree in the config file has to contain the string "nPV": </p>
<pre class="fragment">s   pileupHist_nPV   file.root
</pre><hr/>
<p> The files containing the histograms for the PU reweight are indicated with pileupHist as treeName and they are treated in a different way. There must be only one pileupHist for d and one for s, then the program calculates the weights for the MC, produces a temporary file with just one tree containing the weights (pileupTree) and it is added as friend to the chain of MC. You can also provide directly the "temporary" root file indicating s pileupTree file.root </p>
<hr/>
 </div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="../../doxygen.png" alt="doxygen"/>
</a> 1.8.5
</small></address>
</body>
</html>
